const BootScene=new Phaser.Class({Extends:Phaser.Scene,initialize:function(){Phaser.Scene.call(this,{key:"BootScene"})},preload(){this.load.spritesheet("player","assets/RPG_assets.png",{frameWidth:16,frameHeight:16}),this.load.image("dragonblue","assets/dragonblue.png"),this.load.image("dragonorrange","assets/dragonorrange.png")},create(){this.scene.start("BattleScene")}}),PlayerCharacter=new Phaser.Class({Extends:Unit,initialize:function(e,t,s,i,n,h,a,c){Unit.call(this,e,t,s,i,n,h,a,c),this.flipX=!0,this.setScale(2)}}),Unit=new Phaser.Class({Extends:Phaser.GameObjects.Sprite,initialize:function(e,t,s,i,n,h,a,c){Phaser.GameObjects.Sprite.call(this,e,t,s,i,n),this.type=h,this.maxHp=this.hp,this.hp=a,this.damage=c},attack(e){e.takeDamage(this.damage),this.scene.events.emit("Message",`${this.type} attacks ${e.type} for ${this.damage} damage`)},takeDamage(e){this.hp-=e,this.hp<=0&&(this.hp=0,this.alive=!1)}}),BattleScene=new Phaser.Class({Extends:Phaser.Scene,initialize:function(){Phaser.Scene.call(this,{key:"BattleScene"})},create(){this.cameras.main.setBackgroundColor("rgba(0, 200, 0, 0.5)");const e=new PlayerCharacter(this,250,50,"player",1,"Warrior",100,20);this.add.existing(e);const t=new PlayerCharacter(this,250,100,"player",4,"Mage",80,8);this.add.existing(t);const s=new Enemy(this,50,50,"dragonblue",null,"Dragon",50,3);this.add.existing(s);const i=new Enemy(this,50,100,"dragonorrange",null,"Dragon2",50,3);this.add.existing(i),this.heroes=[e,t],this.enemies=[s,i],this.units=this.heroes.concat(this.enemies),this.scene.launch("UIScene"),this.index=-1},nextTurn(){if(this.index++,this.index>=this.units.length&&(this.index=0),this.units[this.index])if(this.units[this.index]instanceof PlayerCharacter)this.events.emit("PlayerSelect",this.index);else{const e=Math.floor(Math.random()*this.heroes.length);this.units[this.index].attack(this.heroes[e]),this.time.addEvent({delay:3e3,callback:this.nextTurn,callbackScope:this})}},receivePlayerSelection(e,t){"attack"==e&&this.units[this.index].attack(this.enemies[t]),this.time.addEvent({delay:3e3,callback:this.nextTurn,callbackScope:this})}});var Enemy=new Phaser.Class({Extends:Unit,initialize:function(e,t,s,i,n,h,a,c){Unit.call(this,e,t,s,i,n,h,a,c)}});const MenuItem=new Phaser.Class({Extends:Phaser.GameObjects.Text,initialize:function(e,t,s,i){Phaser.GameObjects.Text.call(this,i,e,t,s,{color:"#ffffff",align:"left",fontSize:15})},select(){this.setColor("#f8ff38")},deselect(){this.setColor("#ffffff")}}),Menu=new Phaser.Class({Extends:Phaser.GameObjects.Container,initialize:function(e,t,s,i){Phaser.GameObjects.Container.call(this,s,e,t),this.menuItems=[],this.menuItemIndex=0,this.heroes=i,this.x=e,this.y=t},addMenuItem(e){const t=new MenuItem(0,20*this.menuItems.length,e,this.scene);this.menuItems.push(t),this.add(t)},moveSelectionUp(){this.menuItems[this.menuItemIndex].deselect(),this.menuItemIndex--,this.menuItemIndex<0&&(this.menuItemIndex=this.menuItems.length-1),this.menuItems[this.menuItemIndex].select()},moveSelectionDown(){this.menuItems[this.menuItemIndex].deselect(),this.menuItemIndex++,this.menuItemIndex>=this.menuItems.length&&(this.menuItemIndex=0),this.menuItems[this.menuItemIndex].select()},select(e){e||(e=0),this.menuItems[this.menuItemIndex].deselect(),this.menuItemIndex=e,this.menuItems[this.menuItemIndex].select()},deselect(){this.menuItems[this.menuItemIndex].deselect(),this.menuItemIndex=0},confirm(){},clear(){for(let e=0;e<this.menuItems.length;e++)this.menuItems[e].destroy();this.menuItems.length=0,this.menuItemIndex=0},remap(e){this.clear();for(let t=0;t<e.length;t++){const s=e[t];this.addMenuItem(s.type)}}}),HeroesMenu=new Phaser.Class({Extends:Menu,initialize:function(e,t,s){Menu.call(this,e,t,s)}}),ActionsMenu=new Phaser.Class({Extends:Menu,initialize:function(e,t,s){Menu.call(this,e,t,s),this.addMenuItem("Attack")},confirm(){this.scene.events.emit("SelectEnemies")}}),EnemiesMenu=new Phaser.Class({Extends:Menu,initialize:function(e,t,s){Menu.call(this,e,t,s)},confirm(){this.scene.events.emit("Enemy",this.menuItemIndex)}}),UIScene=new Phaser.Class({Extends:Phaser.Scene,initialize:function(){Phaser.Scene.call(this,{key:"UIScene"})},create(){this.graphics=this.add.graphics(),this.graphics.lineStyle(1,16777215),this.graphics.fillStyle(204620,1),this.graphics.strokeRect(2,150,90,100),this.graphics.fillRect(2,150,90,100),this.graphics.strokeRect(95,150,90,100),this.graphics.fillRect(95,150,90,100),this.graphics.strokeRect(188,150,130,100),this.graphics.fillRect(188,150,130,100),this.menus=this.add.container(),this.heroesMenu=new HeroesMenu(195,153,this),this.actionsMenu=new ActionsMenu(100,153,this),this.enemiesMenu=new EnemiesMenu(8,153,this),this.currentMenu=this.actionsMenu,this.menus.add(this.heroesMenu),this.menus.add(this.actionsMenu),this.menus.add(this.enemiesMenu),this.battleScene=this.scene.get("BattleScene"),this.remapHeroes(),this.remapEnemies(),this.input.keyboard.on("keydown",this.onKeyInput,this),this.battleScene.events.on("PlayerSelect",this.onPlayerSelect,this),this.events.on("SelectEnemies",this.onSelectEnemies,this),this.events.on("Enemy",this.onEnemy,this),this.message=new Message(this,this.battleScene.events),this.add.existing(this.message),this.battleScene.nextTurn()},onEnemy(e){this.heroesMenu.deselect(),this.actionsMenu.deselect(),this.enemiesMenu.deselect(),this.currentMenu=null,this.battleScene.receivePlayerSelection("attack",e)},onPlayerSelect(e){this.heroesMenu.select(e),this.actionsMenu.select(0),this.currentMenu=this.actionsMenu},onSelectEnemies(){this.currentMenu=this.enemiesMenu,this.enemiesMenu.select(0)},remapHeroes(){const{heroes:e}=this.battleScene;this.heroesMenu.remap(e)},remapEnemies(){const{enemies:e}=this.battleScene;this.enemiesMenu.remap(e)},onKeyInput(e){this.currentMenu&&("ArrowUp"===e.code?this.currentMenu.moveSelectionUp():"ArrowDown"===e.code?this.currentMenu.moveSelectionDown():"ArrowRight"===e.code||"Shift"===e.code||"Space"!==e.code&&"ArrowLeft"!==e.code||this.currentMenu.confirm())}});var Message=new Phaser.Class({Extends:Phaser.GameObjects.Container,initialize:function(e,t){Phaser.GameObjects.Container.call(this,e,160,30);const s=this.scene.add.graphics();this.add(s),s.lineStyle(1,16777215,.8),s.fillStyle(204620,.3),s.strokeRect(-90,-15,180,30),s.fillRect(-90,-15,180,30),this.text=new Phaser.GameObjects.Text(e,0,0,"",{color:"#ffffff",align:"center",fontSize:13,wordWrap:{width:160,useAdvancedWrap:!0}}),this.add(this.text),this.text.setOrigin(.5),t.on("Message",this.showMessage,this),this.visible=!1},showMessage(e){this.text.setText(e),this.visible=!0,this.hideEvent&&this.hideEvent.remove(!1),this.hideEvent=this.scene.time.addEvent({delay:2e3,callback:this.hideMessage,callbackScope:this})},hideMessage(){this.hideEvent=null,this.visible=!1}});const config={type:Phaser.AUTO,parent:"content",width:320,height:240,zoom:2,pixelArt:!0,physics:{default:"arcade",arcade:{gravity:{y:0}}},scene:[BootScene,BattleScene,UIScene]},game=new Phaser.Game(config);